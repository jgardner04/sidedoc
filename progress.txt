# Sidedoc TDD Progress Log

## Codebase Patterns
- Use python-docx for all docx file operations
- pytest for testing with fixtures in tests/fixtures/
- All modules should have proper type hints and pass mypy typecheck
- Use dataclasses for models (defined in models.py)
- Click framework for CLI with proper exit codes (0=success, 1=error, 2=not found, 3=invalid format, 4=sync conflict)
- Block types: heading, paragraph, list, image
- Structure.json maps content.md blocks to docx paragraph indices
- Inline formatting: bold/italic converted to markdown, underline stored in Block.inline_formatting metadata
- When processing runs, use `run.bold is True` (not just truthy check) to avoid false positives
- List detection: check for "List Bullet" and "List Number" style names
- Track list_number_counter to auto-number consecutive numbered list items

---

## 2026-01-13 - US-005
- What was implemented:
  - Inline formatting extraction from docx paragraphs
  - Bold text converted to **bold** markdown
  - Italic text converted to *italic* markdown
  - Bold+italic converted to ***bold italic*** markdown
  - Underline preserved in Block.inline_formatting metadata (not in markdown)
  - 5 new tests covering bold, italic, mixed formatting, and underline handling

- Files changed:
  - src/sidedoc/extract.py: Added extract_inline_formatting() function
  - src/sidedoc/reconstruct.py: Fixed type hints for mypy
  - tests/test_extract.py: Added 5 new test cases with helper function
  - progress.txt: Created initial file with codebase patterns

- **Learnings for future iterations:**
  - Pattern: When checking run formatting, use `run.bold is True` not `run.bold is not None`
    because False is a valid value that shouldn't trigger formatting
  - Pattern: Track plain text position separately from markdown position for inline_formatting metadata
  - Gotcha: python-docx paragraph.style can be None, always add null checks
  - Context: Inline formatting positions in Block.inline_formatting use plain text offsets,
    not markdown with formatting markers
  - Testing: create_formatted_docx helper makes it easy to test various formatting combinations

---

## 2026-01-13 - US-006
- What was implemented:
  - List extraction for bulleted lists (- item format)
  - List extraction for numbered lists (1. item format)
  - Auto-numbering for consecutive numbered list items
  - List type tracking to reset numbering when switching between bullets/numbers
  - 4 new tests covering bulleted, numbered, mixed lists, and lists with paragraphs

- Files changed:
  - src/sidedoc/extract.py: Added list detection logic in extract_blocks()
  - tests/test_extract.py: Added 4 new test cases with create_list_docx helper

- **Learnings for future iterations:**
  - Pattern: python-docx identifies list items by style name: "List Bullet" and "List Number"
  - Pattern: Track list_number_counter and previous_list_type to maintain proper numbering
  - Pattern: Reset numbering when encountering non-list content or switching list types
  - Context: List items are stored as separate Block objects with type="list"
  - Gotcha: Numbered lists need manual counter tracking - docx doesn't provide the number
  - Testing: create_list_docx helper simplifies creating test documents with list styles

---
